---
// Impressum Page - Content-driven from Markdown
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import { getEntry, render } from 'astro:content';

const page = await getEntry('pages', 'impressum');
const { Content } = await render(page);
---

<Layout title={page.data.title}>
  <Hero hero={page.data}>
    <Content />
  </Hero>
</Layout>

<script>
  // ROT cipher decryption for contact information (spam protection)
  function rotX(text: string): string {
    const charset =
      '- abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.,:@';
    const offset = charset.length / 2;
    let result = '';
    for (const character of text) {
      const index = charset.indexOf(character);
      const decrypted =
        index > offset ?
          charset.charAt(index - offset)
        : charset.charAt(index + offset);
      result = result.concat(decrypted);
    }
    return result;
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[data-encoded-content]').forEach((element) => {
      if (!(element instanceof HTMLElement)) return;
      const encodedContent = element.dataset.encodedContent;
      if (!encodedContent) return;

      element.style.cursor = 'pointer';
      element.style.textDecoration = 'underline';
      element.addEventListener('click', () => {
        element.outerHTML = rotX(encodedContent);
      });
    });
  });
</script>
