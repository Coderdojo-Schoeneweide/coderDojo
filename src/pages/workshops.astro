---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import WorkshopGridIsland from '../components/islands/WorkshopGridIsland.jsx';
import { getCollection } from 'astro:content';
import { Content, frontmatter } from '../content/workshops/index.md';

// Get all workshops and sort by weight and title
const workshops = await getCollection('workshops');
workshops.sort((a: any, b: any) => {
  const weightA = a.data.weight ?? Number.POSITIVE_INFINITY;
  const weightB = b.data.weight ?? Number.POSITIVE_INFINITY;
  if (weightA !== weightB) return weightA - weightB;
  return a.data.title.localeCompare(b.data.title);
});

// Transform workshops data for the island component
const workshopsData = workshops.map((workshop: any) => ({
  id: workshop.id,
  title: workshop.data.title,
  description: workshop.data.description,
  duration: workshop.data.duration,
  age: workshop.data.age,
  tags: workshop.data.tags,
  image: `/workshops/${workshop.id}/${workshop.data.image}`,
  prevKnowledge: workshop.data.prevKnowledge || 'Nicht angegeben',
  content: workshop.body, // Markdown content
  folder: workshop.id, // For the modal system
}));
---

<Layout
  title={frontmatter.title}
  description="Entdecke unsere kostenlosen IT-Workshops fÃ¼r Kinder und Jugendliche. Von Scratch bis Python - hier lernst du spielerisch programmieren!"
>
  <Hero
    hero={{
      title: frontmatter.title,
      background: frontmatter.background,
    }}
  >
    <Content />
  </Hero>

  <!-- Workshop Grid Section -->
  <section
    class="text-accent-900 bg-white py-20 dark:bg-gray-900 dark:text-gray-100"
  >
    <div class="container mx-auto px-6">
      <WorkshopGridIsland workshops={workshopsData} client:load />
    </div>
  </section>
</Layout>
